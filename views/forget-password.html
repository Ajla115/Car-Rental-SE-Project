<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />

    <title>Forget Password</title>
    <meta content="" name="description" />
    <meta content="" name="keywords" />

    <!-- Favicon -->
    <link href="../assets/img/car-icon.png" rel="icon" />

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i"
      rel="stylesheet"
    />

    <!-- Vendor CSS Files -->
    <link href="../assets/vendor/aos/aos.css" rel="stylesheet" />
    <link
      href="../assets/vendor/bootstrap/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="../assets/vendor/bootstrap-icons/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link
      href="../assets/vendor/boxicons/css/boxicons.min.css"
      rel="stylesheet"
    />
    <link
      href="../assets/vendor/glightbox/css/glightbox.min.css"
      rel="stylesheet"
    />
    <link href="../assets/vendor/remixicon/remixicon.css" rel="stylesheet" />
    <link
      href="../assets/vendor/swiper/swiper-bundle.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css"
    />

    <!-- Template Main CSS File -->
    <link href="../assets/css/style.css" rel="stylesheet" />

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/jquery.validate.min.js"></script>
    <script src="../assets/js/utils.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script src="../assets/js/main.js"></script>
    <script src="../assets/js/restclient.js"></script>
    <script src="../assets/js/customer-service.js"></script>
    <script src="../assets/js/user-service.js"></script>

    <style>
      .toggle-password {
        cursor: pointer;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
      }
    </style>
  </head>
  <body>
    <!-- ======= Header/Navigation Menu ======= -->
    <header id="header" class="fixed-top">
      <div
        class="container d-flex align-items-center justify-content-lg-between"
      >
        <h1 class="logo me-auto me-lg-0">
          <a href="index.html">DRIVENATION<span>.</span></a>
        </h1>
      </div>
    </header>

    <section id="login" class="page1">
      <div class="container py-1 h-100">
        <!-- reduced vertical padding here -->
        <div class="row d-flex justify-content-center align-items-center h-100">
          <div class="col-12 col-md-8 col-lg-6 col-xl-5">
            <div class="card" style="border-radius: 1rem">
              <div class="card-body p-3">
                <!-- reduced padding inside the card body -->
                <div class="mb-md-1 mt-md-1 pb-1">
                  <!-- reduced margins here -->
                  <h3 class="fw-bold mb-2">Reset Your Password</h3>
                  <div class="line-separator"></div>
                  <form id="reset-form" role="form">
                    <label class="form-label" for="email">Email</label>
                    <div class="form-outline form-white mb-4">
                      <input
                        type="email"
                        id="email"
                        name="email"
                        class="form-control form-control-lg"
                      />
                    </div>
                    <label class="form-label" for="password"
                      >New Password:</label
                    >
                    <div class="form-outline form-white mb-4 position-relative">
                      <input
                        type="password"
                        id="password"
                        name="password"
                        class="form-control form-control-lg"
                      />
                      <i
                        class="bi bi-eye-slash position-absolute toggle-password"
                        id="togglePassword"
                      ></i>
                    </div>
                    <label class="form-label" for="confirm_password"
                      >Confirm New Password:</label
                    >
                    <div class="form-outline form-white mb-4 position-relative">
                      <input
                        type="password"
                        id="confirm_password"
                        name="confirm_password"
                        class="form-control form-control-lg"
                      />
                      <i
                        class="bi bi-eye-slash position-absolute toggle-password"
                        id="toggleConfirmPassword"
                      ></i>
                    </div>
                    <button class="btn btn-lg px-5" type="submit">
                      Reset Password
                    </button>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <script>
      $(document).ready(function () {
        // Toggle password visibility
        $(".toggle-password").click(function () {
          $(this).toggleClass("bi-eye bi-eye-slash");
          var input = $(this).siblings("input");
          if (input.attr("type") === "password") {
            input.attr("type", "text");
          } else {
            input.attr("type", "password");
          }
        });

        // Form validation
        $("#reset-form").validate({
          rules: {
            email: {
              required: true,
              email: true,
            },
            password: {
              required: true,
              minlength: 8,
              maxlength: 15,
            },
            confirm_password: {
              required: true,
              equalTo: "#password",
            },
          },
          messages: {
            email: {
              required: "Please enter your email",
              email: "Please enter a valid email address",
            },
            password: {
              required: "Please enter a new password",
              minlength: "Your password must be at least 8 characters long",
              maxlength: "Your password must be less than 15 characters long",
            },
            confirm_password: {
              required: "Please confirm your new password",
              equalTo: "Passwords do not match",
            },
          },
          submitHandler: function (form) {
            var email = $("#email").val();
            var password = $("#password").val();
            var confirm_password = $("#confirm_password").val();

            $.ajax({
              url: "../rest/resetpassword",
              type: "PUT",
              contentType: "application/json",
              data: JSON.stringify({
                email: email,
                password: password,
                confirm_password: confirm_password,
              }),

              success: function (response) {
                toastr.success("Password reset successful");
                setTimeout(function () {
                  window.location = "login.html";
                }, 3000);
              },
              error: function (XMLHttpRequest, textStatus, errorThrown) {
                var errorMessage =
                  XMLHttpRequest.responseText ||
                  "Login failed with status: " + textStatus;
                toastr.error(errorMessage);
              },
            });
          },
        });
      });
    </script>
  </body>
</html>
